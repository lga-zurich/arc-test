name: zoltan's playground
on:
  workflow_dispatch:

jobs:
  test:
    # You need to use the INSTALLATION_NAME from the previous step
    runs-on: arc-runner-set
    container:
      image: ubuntu:22.04
    steps:
      - name: install build tools
        run: |
          apt update
          apt install -y make git docker-compose curl ca-certificates
          install -m 0755 -d /etc/apt/keyrings
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
          chmod a+r /etc/apt/keyrings/docker.asc
          echo   "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
                 $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
          apt update
          apt install -y docker-ce
      - name: check out presto
        uses: actions/checkout@master
        with:
          repository: prestodb/presto
      - name: fix permissions
        run: |
          git config --system --add safe.directory "$GITHUB_WORKSPACE"
      - name: update velox
        run: |
          cd presto-native-execution
          make velox-submodule
      - name: disk space consumption before build
        run: df
      - name: build dependency image
        run: docker compose build centos-native-dependency
